See https://unix.stackexchange.com/questions/721874/jail-sandbox-process-on-an-overlay-root-and-track-changes/ for details.

Log:

mkdir -p /tmp/overlay-test/{upper,workdir,mount,view}
unshare -rnm

unionfs-fuse -o cow,max_files=32768,relaxed_permissions /tmp/overlay-test/upper=RW:/=RO /tmp/overlay-test/mount


mount.mergerfs / /tmp/overlay-test/view -o use_ino,posix_acl=true
mount -t overlay overlay -o lowerdir=/tmp/overlay-test/view,upperdir=/tmp/overlay-test/upper,workdir=/tmp/overlay-test/workdir /tmp/overlay-test/mount
mount --rbind /dev /tmp/overlay-test/mount/dev
mount --rbind /proc /tmp/overlay-test/mount/proc
chroot /tmp/overlay-test/mount /bin/bash


lowerdir=/tmp/chast/707afd6a-def8-4934-9c03-d819a92f3fb9/mergerfs,upperdir=/shared/home/rjenni/Projects/mse-repos/master-thesis/chast/chast-core/cli/.chast/tmp/707afd6a-def8-4934-9c03-d819a92f3fb9,workdir=/tmp/chast/707afd6a-def8-4934-9c03-d819a92f3fb9/overlayFsWorkingDir
----

mount --rbind /dev /tmp/overlay-test/view/dev
mount --rbind /etc /tmp/overlay-test/view/etc

mount --rbind /proc /tmp/overlay-test/mount/proc
mount --rbind /sys /tmp/overlay-test/mount/sys

journalctl -b -f

----

mkdir -p /tmp/overlay-test/{upper,workdir,mount}
fuse-overlayfs -o lowerdir=/,upperdir=/tmp/overlay-test/upper,workdir=/tmp/overlay-test/workdir /tmp/overlay-test/mount

# unshare -rm chroot /tmp/overlay-test/mount ## not working - maybe because of the kernel
sudo chroot /tmp/overlay-test/mount

fusermount -u /tmp/overlay-test/mount


// overlayfs: failed to retrieve lower fileattr (/shared, err=-1)
